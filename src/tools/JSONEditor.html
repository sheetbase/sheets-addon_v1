<!DOCTYPE html>
<html>
<head>

  <base target="_top">

  <!-- Addon -->
  <link rel="stylesheet" href="https://sheetbase.github.io/sheets-addon/css/addon.css">
  <link rel="stylesheet" href="https://sheetbase.github.io/sheets-addon/css/add-ons1.css">

  <!-- JSON Editor -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/6.3.0/jsoneditor.min.css" />

  <style>
    #jsoneditor {
      width: 100%;
      height: 500px;
    }
  </style>

</head>

<body>

  <main class="container">

    <section id="jsoneditor"></section>

    <section id="vue">

      <div class="editor margin-top">
        <button class="button" v-on:click="getJSON">Get &rarr;</button>
        <button class="button" v-on:click="clearJSON">Clear</button>
        <button class="button action right" v-on:click="setJSON">&larr; Set</button>
      </div>

    </section>  

  </main>

  <!-- Vue -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js"></script>

  <!-- JSON Editor -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/6.3.0/jsoneditor.min.js"></script>

  <script>

    // init
    var editor = new JSONEditor(
      document.getElementById('jsoneditor'),
      {
        modes: [ 'tree', 'code', 'preview' ],
      }
    );

    // init vue app
    var app = new Vue({
      el: '#vue',
      data: {},
      methods: {

        errorAlert: function (msg, el, title) {
          console.error(msg, el ? el: '');
          return google.script.run.withFailureHandler(this.errorAlert).displayError(msg, title);
        },

        clearJSON: function () {
          return editor.set({});
        },

        getJSON: function () {
          var _this = this;
          return google.script.run
          .withSuccessHandler(function (jsonText) {
            try {
              editor.setText(jsonText);
            } catch (e) {
              return _this.errorAlert('Look like your data is not a valid JSON.', null, 'Bad JSON!');
            }
          })
          .withFailureHandler(this.errorAlert)
          .getData();
        },

        setJSON: function () {
          var jsonText = editor.getText();
          return google.script.run
          .withFailureHandler(this.errorAlert)
          .setData(jsonText);
        },

      }
    });

  </script>

</body>
</html>